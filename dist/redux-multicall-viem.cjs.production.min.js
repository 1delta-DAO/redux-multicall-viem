"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,e=require("react"),r=(t=e)&&"object"==typeof t&&"default"in t?t.default:t,n=require("react-redux"),a=require("viem"),u=require("@reduxjs/toolkit"),o={valid:!1,blockNumber:void 0,data:void 0},i={valid:!1,result:void 0,loading:!1,syncing:!1,error:!1},l={valid:!0,result:void 0,loading:!0,syncing:!0,error:!1};function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function s(t,e,r,n,a,u,o){try{var i=t[u](o),l=i.value}catch(t){return void r(t)}i.done?e(l):Promise.resolve(l).then(n,a)}function f(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var u=t.apply(e,r);function o(t){s(u,n,a,o,i,"next",t)}function i(t){s(u,n,a,o,i,"throw",t)}o(void 0)}))}}function d(t,e,r){if(y())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var a=new(t.bind.apply(t,n));return r&&g(a,r.prototype),a}function p(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return c(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(){return(h=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(null,arguments)}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function m(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,g(t,e)}function y(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(y=function(){return!!t})()}function b(){b=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},u="function"==typeof Symbol?Symbol:{},o=u.iterator||"@@iterator",i=u.asyncIterator||"@@asyncIterator",l=u.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function s(t,e,r,n){var u=Object.create((e&&e.prototype instanceof m?e:m).prototype),o=new S(n||[]);return a(u,"_invoke",{value:O(t,r,o)}),u}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var d="suspendedStart",p="executing",h="completed",v={};function m(){}function y(){}function g(){}var k={};c(k,o,(function(){return this}));var w=Object.getPrototypeOf,N=w&&w(w(_([])));N&&N!==r&&n.call(N,o)&&(k=N);var L=g.prototype=m.prototype=Object.create(k);function x(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(a,u,o,i){var l=f(t[a],t,u);if("throw"!==l.type){var c=l.arg,s=c.value;return s&&"object"==typeof s&&n.call(s,"__await")?e.resolve(s.__await).then((function(t){r("next",t,o,i)}),(function(t){r("throw",t,o,i)})):e.resolve(s).then((function(t){c.value=t,o(c)}),(function(t){return r("throw",t,o,i)}))}i(l.arg)}var u;a(this,"_invoke",{value:function(t,n){function a(){return new e((function(e,a){r(t,n,e,a)}))}return u=u?u.then(a,a):a()}})}function O(e,r,n){var a=d;return function(u,o){if(a===p)throw Error("Generator is already running");if(a===h){if("throw"===u)throw o;return{value:t,done:!0}}for(n.method=u,n.arg=o;;){var i=n.delegate;if(i){var l=R(i,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===d)throw a=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=p;var c=f(e,r,n);if("normal"===c.type){if(a=n.done?h:"suspendedYield",c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(a=h,n.method="throw",n.arg=c.arg)}}}function R(e,r){var n=r.method,a=e.iterator[n];if(a===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,R(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var u=f(a,e.iterator,r.arg);if("throw"===u.type)return r.method="throw",r.arg=u.arg,r.delegate=null,v;var o=u.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function M(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function _(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,u=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return u.next=u}}throw new TypeError(typeof e+" is not iterable")}return y.prototype=g,a(L,"constructor",{value:g,configurable:!0}),a(g,"constructor",{value:y,configurable:!0}),y.displayName=c(g,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,c(t,l,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},x(E.prototype),c(E.prototype,i,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,a,u){void 0===u&&(u=Promise);var o=new E(s(t,r,n,a),u);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},x(L),c(L,l,"Generator"),c(L,o,(function(){return this})),c(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return i.type="throw",i.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var u=this.tryEntries.length-1;u>=0;--u){var o=this.tryEntries[u],i=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var u=a;break}}u&&("break"===t||"continue"===t)&&u.tryLoc<=e&&e<=u.finallyLoc&&(u=null);var o=u?u.completion:{};return o.type=t,o.arg=e,u?(this.method="next",this.next=u.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;I(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:_(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function g(t,e){return(g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function k(t){var e="function"==typeof Map?new Map:void 0;return(k=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return d(t,arguments,v(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),g(r,t)})(t)}function w(t){var e=t.address+"-"+t.callData;if(t.gasRequired){if(!Number.isSafeInteger(t.gasRequired))throw new Error("Invalid number: "+t.gasRequired);e+="-"+t.gasRequired}return e}function N(t){var e=t.split("-");if(![2,3].includes(e.length))throw new Error("Invalid call key: "+t);return h({address:e[0],callData:e[1]},e[2]?{gasRequired:Number.parseInt(e[2])}:{})}function L(t){var e,r;return null!=(e=null==t||null==(r=t.filter((function(t){return Boolean(t)})))||null==(r=r.map(w))?void 0:r.sort())?e:[]}function x(t){return null!=t&&t.length?t.map((function(t){return N(t)})):null}function E(t,r,n,a){var u=e.useMemo((function(){var e=t.reduce((function(t,e){return e.blockNumber?Math.min(null!=t?t:e.blockNumber,e.blockNumber):t}),void 0);return Math.max(null!=e?e:0,null!=a?a:0)}),[t,a]);return e.useMemo((function(){return t.map((function(t,e){var a="function"==typeof n?n(e):n;return O(t,r,a,u)}))}),[r,n,t,u])}function O(t,e,r,n){if(!t||!t.valid)return i;var u=t.data,o=t.blockNumber;if(!(o&&e&&r&&n))return l;var c=u&&u.length>2,s=o<n,f=void 0;if(c&&u)try{f=a.decodeFunctionResult({abi:e,functionName:r,data:u})}catch(t){return console.debug("Result data parsing failed",r,u),{valid:!0,loading:!1,error:!0,syncing:s,result:f}}return{valid:!0,loading:!1,syncing:s,result:f,error:!c}}function R(t){return null!=t&&("bigint"==typeof BigInt(t)||-1!==["string","number"].indexOf(typeof t))}function M(t){return void 0===t||Array.isArray(t)&&t.every((function(t){return R(t)||Array.isArray(t)&&t.every(R)}))}function I(t,r,a,u){var i=t.reducerPath,l=t.actions,c=n.useSelector((function(t){return t[i].callResults})),s=n.useSelector((function(t){return t[i].listenerOptions})),f=n.useDispatch(),d=e.useMemo((function(){return JSON.stringify(L(a))}),[a]);e.useEffect((function(){var t,e,n,a=x(JSON.parse(d));if(r&&a){var o=null==(t=(null!=s?s:{})[r])?void 0:t.blocksPerFetch,i=null!=(e=null!=(n=null==u?void 0:u.blocksPerFetch)?n:o)?e:1;return f(l.addMulticallListeners({chainId:r,calls:a,options:{blocksPerFetch:i}})),function(){f(l.removeMulticallListeners({chainId:r,calls:a,options:{blocksPerFetch:i}}))}}}),[l,r,f,u,d,s]);var p=e.useRef([]);return e.useMemo((function(){for(var t,e,n=p.current.length!==a.length,u=[],i=0;i<a.length;++i){var l=a[i],s=o;if(r&&l){var f,d=null==(f=c[r])?void 0:f[w(l)];s={valid:!0,data:null!=d&&d.data&&"0x"!==d.data?d.data:void 0,blockNumber:null==d?void 0:d.blockNumber}}n=n||!((t=s).valid===(e=p.current[i]).valid&&t.data===e.data&&t.blockNumber===e.blockNumber),u.push(s)}return n&&(p.current=u),p.current}),[c,a,r])}function S(t,r,n,u,o,i,l){var c=(null!=l?l:{}).gasRequired,s=e.useMemo((function(){var t;return u&&(null==(t=a.getAbiItem({abi:u.abi,name:o}))?void 0:t.name)}),[u,o]),f=e.useMemo((function(){return u&&s?i.map((function(t){return M(t)?a.encodeFunctionData({abi:u.abi,functionName:s,args:t}):void 0})):[]}),[i,u,s]);return E(I(t,r,e.useMemo((function(){return u?f.map((function(t){if(t)return{address:u.address,callData:t,gasRequired:c}})):[]}),[u,f,c]),l),null==u?void 0:u.abi,s,n)}function _(t,r,n,a,u,o,i,l){var c=(null!=l?l:{}).gasRequired,s=j(o,u,i),f=s.fragment,d=s.callData;return E(I(t,r,e.useMemo((function(){return d?a.map((function(t){if(t)return{address:t,callData:d,gasRequired:c}})):[]}),[a,d,c]),l),u,f,n)}function P(t,r,n,a,u,o,l){var c;return null!=(c=S(t,r,n,a,u,e.useMemo((function(){return[o]}),[o]),l)[0])?c:i}function D(t,r,n,u,o,i){var l=(null!=i?i:{}).gasRequired,c=I(t,r,e.useMemo((function(){return u?o.map((function(t){return{address:u.address,callData:t,gasRequired:l}})):[]}),[o,u,l]),i),s=e.useCallback((function(t){var e;return null==(e=a.getAbiItem({abi:null==u?void 0:u.abi,name:o[t].substring(0,10)}))?void 0:e.name}),[o,u]);return E(c,null==u?void 0:u.abi,s,n)}function A(t,r,a,u,i,l,c){var s=(null!=c?c:{}).gasRequired,f=j(i,u,l),d=f.fragment,h=f.callData,v=function(t,r,a){var u=t.reducerPath,i=t.actions,l=n.useSelector((function(t){return t[u].callResults})),c=n.useSelector((function(t){return t[u].listenerOptions})),s=n.useDispatch(),f=e.useMemo((function(){var t=C(r).sort().map((function(t){return[t,L(r[t])]}));return JSON.stringify(t)}),[r]);return e.useEffect((function(){var t=JSON.parse(f);if(null!=t&&t.length)return n.batch((function(){for(var e,r=p(t);!(e=r()).done;){var n,u,o,l=e.value,f=l[0],d=x(l[1]);if(null!=d&&d.length){var h=null==(n=(null!=c?c:{})[f])?void 0:n.blocksPerFetch,v=null!=(u=null!=(o=null==a?void 0:a.blocksPerFetch)?o:h)?u:1;s(i.addMulticallListeners({chainId:f,calls:d,options:{blocksPerFetch:v}}))}}})),function(){n.batch((function(){for(var e,r=p(t);!(e=r()).done;){var n,u,o,l=e.value,f=l[0],d=x(l[1]);if(null!=d&&d.length){var h=null==(n=(null!=c?c:{})[f])?void 0:n.blocksPerFetch,v=null!=(u=null!=(o=null==a?void 0:a.blocksPerFetch)?o:h)?u:1;s(i.removeMulticallListeners({chainId:f,calls:d,options:{blocksPerFetch:v}}))}}}))}}),[i,s,a,f,c]),e.useMemo((function(){return C(r).reduce((function(t,e){return t[e]=r[e].map((function(t){var r;if(!e||!t)return o;var n=null==(r=l[e])?void 0:r[w(t)];return{valid:!0,data:null!=n&&n.data&&"0x"!==n.data?n.data:void 0,blockNumber:null==n?void 0:n.blockNumber}})),t}),{})}),[l,r])}(t,e.useMemo((function(){return h&&a?C(a).reduce((function(t,e){var r=a[e].map((function(t){if(t)return{address:t,callData:h,gasRequired:s}}));return t[e]=r,t}),{}):{}}),[a,h,s]),c);return e.useMemo((function(){return C(v).reduce((function(t,e){var n=null==r?void 0:r[e];return t[e]=v[e].map((function(t){return O(t,u,d,n)})),t}),{})}),[d,u,v,r])}function T(t,r,n,a,u,o,l){var c=A(t,r,e.useMemo((function(){return C(n).reduce((function(t,e){return t[e]=[n[e]],t}),{})}),[n]),a,u,o,l);return e.useMemo((function(){return C(n).reduce((function(t,e){var r,n;return t[e]=null!=(r=null==(n=c[e])?void 0:n[0])?r:i,t}),{})}),[n,c])}function j(t,r,n){var u=e.useMemo((function(){var e;return r&&(null==(e=a.getAbiItem({abi:r,name:t}))?void 0:e.name)}),[r,t]),o=e.useMemo((function(){return u&&M(n)?a.encodeFunctionData({abi:r,functionName:u,args:n}):void 0}),[n,r,u]);return{fragment:u,callData:o}}function C(t){return Object.keys(t).map((function(t){return parseInt(t,10)}))}var F={callResults:{}};function B(t,e){return r=t+Math.round(Math.random()*Math.max(0,e-t)),new Promise((function(t){return setTimeout(t,r)}));var r}var q=function(t){function e(){var e;return(e=t.call(this,"Cancelled")||this).isCancelledError=!0,e}return m(e,t),e}(k(Error)),G=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).isRetryableError=!0,e}return m(e,t),e}(k(Error)),U=[{inputs:[],name:"getCurrentBlockTimestamp",outputs:[{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"addr",type:"address"}],name:"getEthBalance",outputs:[{internalType:"uint256",name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"target",type:"address"},{internalType:"uint256",name:"gasLimit",type:"uint256"},{internalType:"bytes",name:"callData",type:"bytes"}],internalType:"struct PancakeInterfaceMulticall.Call[]",name:"calls",type:"tuple[]"}],name:"multicall",outputs:[{internalType:"uint256",name:"blockNumber",type:"uint256"},{components:[{internalType:"bool",name:"success",type:"bool"},{internalType:"uint256",name:"gasUsed",type:"uint256"},{internalType:"bytes",name:"returnData",type:"bytes"}],internalType:"struct PancakeInterfaceMulticall.Result[]",name:"returnData",type:"tuple[]"}],stateMutability:"nonpayable",type:"function"}],J={n:Infinity,minWait:1e3,maxWait:2500};function V(t,e,r,n){return W.apply(this,arguments)}function W(){return(W=f(b().mark((function t(e,r,n,a){var u,o,i,l,c,s;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.debug("Fetching chunk",r,n,r.map((function(t){var e;return{target:t.address,callData:t.callData,gasLimit:null!=(e=t.gasRequired)?e:1e6}}))),t.prev=1,t.next=4,e.provider.simulateContract({abi:U,address:e.address,functionName:"multicall",args:[r.map((function(t){var e;return{target:t.address,callData:t.callData,gasLimit:null!=(e=t.gasRequired)?e:1e6}}))],blockNumber:BigInt(n)});case 4:return u=t.sent.result[1],a&&u.forEach((function(t,e){var n,a,u=t.gasUsed;!t.success&&2===t.returnData.length&&u>=Math.floor(.95*(null!=(n=r[e].gasRequired)?n:1e6))&&console.warn("A call failed due to requiring "+u.toString()+" vs. allowed "+(null!=(a=r[e].gasRequired)?a:1e6),r[e])})),t.abrupt("return",u);case 11:if(t.prev=11,t.t0=t.catch(1),-32e3!==(l=t.t0).code&&-1===(null==(o=l.message)?void 0:o.indexOf("header not found"))){t.next=18;break}throw new G("header not found for block number "+n);case 18:if(-32603!==l.code&&-1===(null==(i=l.message)?void 0:i.indexOf("execution ran out of gas"))){t.next=28;break}if(!(r.length>1)){t.next=28;break}return c=Math.floor(r.length/2),t.next=24,Promise.all([V(e,r.slice(0,c),n),V(e,r.slice(c,r.length),n)]);case 24:return t.abrupt("return",(s=t.sent)[0].concat(s[1]));case 28:throw console.error("Failed to fetch chunk",l),l;case 30:case"end":return t.stop()}}),t,null,[[1,11]])})))).apply(this,arguments)}function K(t){var r=t.context,a=t.chainId,u=t.latestBlockNumber,o=t.multicallInfo,i=t.isDebug,l=t.listenerOptions,c=r.actions,s=r.reducerPath,d=n.useDispatch();e.useEffect((function(){a&&l&&d(c.updateListenerOptions({chainId:a,listenerOptions:l}))}),[a,l,c,d]);var h,v,m,y,g=n.useSelector((function(t){return t[s]})),k=(m=(v=e.useState(h=g.callListeners))[0],y=v[1],e.useEffect((function(){var t=setTimeout((function(){y(h)}),100);return function(){clearTimeout(t)}}),[h,100]),m),L=e.useRef(),x=e.useMemo((function(){return function(t,e){if(!t||!e)return{};var r=t[e];return r?Object.keys(r).reduce((function(t,e){var n=r[e];return t[e]=Object.keys(n).filter((function(t){var e=parseInt(t);return!(e<=0)&&n[e]>0})).reduce((function(t,e){return Math.min(t,parseInt(e))}),Infinity),t}),{}):{}}(k,a)}),[k,a]),E=e.useMemo((function(){var t=function(t,e,r,n){return r&&n?t[r]?Object.keys(e).filter((function(a){var u=t[r][a];if(!u)return!0;var o=n-(e[a]-1);return!(u.fetchingBlockNumber&&u.fetchingBlockNumber>=o)&&(!u.blockNumber||u.blockNumber<o)})):Object.keys(e):[]}(g.callResults,x,a,u);return JSON.stringify(t.sort())}),[a,g.callResults,x,u]);return e.useEffect((function(){if(u&&a&&o){var t=JSON.parse(E);if(0!==t.length){var e=t.map((function(t){return N(t)})),r=function(t,e,r){return void 0===r&&(r=2e5),t.sort((function(t,e){var n,a;return(null!=(n=e.gasRequired)?n:r)-(null!=(a=t.gasRequired)?a:r)})).reduce((function(t,e){for(var n,a,u=null!=(n=e.gasRequired)?n:r,o=p(t);!(a=o()).done;){var i=a.value;if(i.cumulativeGasLimit+u<=1e8)return i.calls.push(e),i.cumulativeGasLimit+=u,t}return t.push({calls:[e],cumulativeGasLimit:u}),t}),[]).map((function(t){return t.calls}))}(e);L.current&&L.current.blockNumber!==u&&L.current.cancellations.forEach((function(t){return t()})),d(c.fetchingMulticallResults({calls:e,chainId:a,fetchingBlockNumber:u}));var n={actions:c,dispatch:d,chainId:a,latestBlockNumber:u,isDebug:i},l=r.map((function(t){var e,r,a,l,c,s,d,p=(e=function(){return V(o,t,u,i)},l=(r=J).n,c=r.minWait,s=r.maxWait,d=!1,{promise:new Promise(function(){var t=f(b().mark((function t(r,n){var u;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=n;case 1:return u=void 0,t.prev=3,t.next=6,e();case 6:return u=t.sent,d||(r(u),d=!0),t.abrupt("break",24);case 11:if(t.prev=11,t.t0=t.catch(3),!d){t.next=15;break}return t.abrupt("break",24);case 15:if(!(l<=0)&&t.t0.isRetryableError){t.next=19;break}return n(t.t0),d=!0,t.abrupt("break",24);case 19:l--;case 20:return t.next=22,B(c,s);case 22:t.next=1;break;case 24:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(e,r){return t.apply(this,arguments)}}()),cancel:function(){d||(d=!0,a(new q))}}),h=p.cancel;return p.promise.then((function(e){return function(t,e,r){var n=t.actions,a=t.dispatch,u=t.chainId,o=t.latestBlockNumber,i=t.isDebug,l=e.reduce((function(t,e,n){var a;return r[n].success?t.results[w(e)]=null!=(a=r[n].returnData)?a:null:t.erroredCalls.push(e),t}),{erroredCalls:[],results:{}}),c=l.erroredCalls,s=l.results;Object.keys(s).length>0&&a(n.updateMulticallResults({chainId:u,results:s,blockNumber:o})),c.length>0&&(i?r.forEach((function(t,r){t.success||console.debug("Call failed",e[r],t)})):console.debug("Calls errored in fetch",c),a(n.errorFetchingMulticallResults({calls:c,chainId:u,fetchingBlockNumber:o})))}(n,t,e)})).catch((function(e){return function(t,e,r){var n=t.actions,a=t.dispatch,u=t.chainId,o=t.latestBlockNumber;r.isCancelledError?console.debug("Cancelled fetch for blockNumber",o,e,u):(console.error("Failed to fetch multicall chunk",e,u,r),a(n.errorFetchingMulticallResults({calls:e,chainId:u,fetchingBlockNumber:o})))}(n,t,e)})),h}));L.current={blockNumber:u,cancellations:l}}}}),[c,a,o,d,E,u,i]),null}function H(t){return function(e){return r.createElement(K,Object.assign({context:t},e))}}exports.CHUNK_GAS_LIMIT=1e8,exports.CONSERVATIVE_BLOCK_GAS_LIMIT=1e7,exports.DEFAULT_BLOCKS_PER_FETCH=1,exports.DEFAULT_CALL_GAS_REQUIRED=1e6,exports.DEFAULT_CHUNK_GAS_REQUIRED=2e5,exports.INVALID_CALL_STATE=i,exports.INVALID_RESULT=o,exports.LOADING_CALL_STATE=l,exports.NEVER_RELOAD={blocksPerFetch:Infinity},exports.createMulticall=function(t){var e,r=null!=(e=null==t?void 0:t.reducerPath)?e:"multicall",n=function(t){return u.createSlice({name:t,initialState:F,reducers:{addMulticallListeners:function(t,e){var r,n=e.payload,a=n.calls,u=n.chainId,o=n.options.blocksPerFetch,i=t.callListeners?t.callListeners:t.callListeners={};i[u]=null!=(r=i[u])?r:{},a.forEach((function(t){var e,r,n=w(t);i[u][n]=null!=(e=i[u][n])?e:{},i[u][n][o]=(null!=(r=i[u][n][o])?r:0)+1}))},removeMulticallListeners:function(t,e){var r=e.payload,n=r.calls,a=r.chainId,u=r.options.blocksPerFetch,o=t.callListeners?t.callListeners:t.callListeners={};o[a]&&n.forEach((function(t){var e=w(t);o[a][e]&&o[a][e][u]&&(1===o[a][e][u]?delete o[a][e][u]:o[a][e][u]--)}))},fetchingMulticallResults:function(t,e){var r,n=e.payload,a=n.chainId,u=n.fetchingBlockNumber,o=n.calls;t.callResults[a]=null!=(r=t.callResults[a])?r:{},o.forEach((function(e){var r=w(e),n=t.callResults[a][r];if(n){var o;if((null!=(o=n.fetchingBlockNumber)?o:0)>=u)return;t.callResults[a][r].fetchingBlockNumber=u}else t.callResults[a][r]={fetchingBlockNumber:u}}))},errorFetchingMulticallResults:function(t,e){var r,n=e.payload,a=n.chainId,u=n.fetchingBlockNumber,o=n.calls;t.callResults[a]=null!=(r=t.callResults[a])?r:{},o.forEach((function(e){var r=w(e),n=t.callResults[a][r];n&&"number"==typeof n.fetchingBlockNumber&&n.fetchingBlockNumber<=u&&(delete n.fetchingBlockNumber,n.data=null,n.blockNumber=u)}))},updateMulticallResults:function(t,e){var r,n=e.payload,a=n.chainId,u=n.results,o=n.blockNumber;t.callResults[a]=null!=(r=t.callResults[a])?r:{},Object.keys(u).forEach((function(e){var r,n=t.callResults[a][e];(null!=(r=null==n?void 0:n.blockNumber)?r:0)>o||(null==n?void 0:n.data)===u[e]&&(null==n?void 0:n.blockNumber)===o||(t.callResults[a][e]={data:u[e],blockNumber:o})}))},updateListenerOptions:function(t,e){var r,n=e.payload,a=n.chainId,u=n.listenerOptions;t.listenerOptions=null!=(r=t.listenerOptions)?r:{},t.listenerOptions[a]=u}}})}(r),a=n.actions,o={reducerPath:r,actions:a};return{reducerPath:r,reducer:n.reducer,actions:a,hooks:{useMultipleContractSingleData:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return _.apply(void 0,[o].concat(e))},useSingleContractMultipleData:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return S.apply(void 0,[o].concat(e))},useSingleContractWithCallData:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return D.apply(void 0,[o].concat(e))},useSingleCallResult:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return P.apply(void 0,[o].concat(e))},useMultiChainMultiContractSingleData:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return A.apply(void 0,[o].concat(e))},useMultiChainSingleContractSingleData:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return T.apply(void 0,[o].concat(e))}},Updater:H(o)}};
//# sourceMappingURL=redux-multicall-viem.cjs.production.min.js.map
